(function(l,r){function t(a,c){for(var b in c)c.hasOwnProperty(b)&&(a.style[b]=c[b])}function n(a,c){var b=null;l.getComputedStyle?b=document.defaultView.getComputedStyle(a,null).getPropertyValue(c):a.currentStyle&&(b=a.currentStyle[c]);return b}function q(a,c,b){var d={},e;if("save"===c){for(e in b)b.hasOwnProperty(e)&&(d[e]=n(a,e));t(a,b)}else"apply"===c&&t(a,b);return d}function v(a){var c=parseInt(n(a,"border-left-width"),10)+parseInt(n(a,"border-right-width"),10),b=parseInt(n(a,"padding-left"),
10)+parseInt(n(a,"padding-right"),10);a=a.offsetWidth;isNaN(c)&&(c=0);return c+b+a}function u(a){var c=parseInt(n(a,"border-top-width"),10)+parseInt(n(a,"border-bottom-width"),10),b=parseInt(n(a,"padding-top"),10)+parseInt(n(a,"padding-bottom"),10);a=parseInt(n(a,"height"),10);isNaN(c)&&(c=0);return c+b+a}function p(a,c,b){b=b||"";var d=c.getElementsByTagName("head")[0];c=c.createElement("link");a={type:"text/css",id:b,rel:"stylesheet",href:a,name:a,media:"screen"};for(var e in a)a.hasOwnProperty(e)&&
(c[e]=a[e]);d.appendChild(c)}function k(a){return a.contentDocument||a.contentWindow.document}function m(a,c){c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/\n/g,"<br>");c=c.replace(/<br>\s/g,"<br>&nbsp;");c=c.replace(/\s\s\s/g,"&nbsp; &nbsp;");c=c.replace(/\s\s/g,"&nbsp; ");c=c.replace(/^ /,"&nbsp;");a.innerHTML=c;return!0}function b(a){return a.replace(/\u00a0/g," ").replace(/&nbsp;/g," ")}function f(){var a=-1,c=navigator.userAgent,b;"Microsoft Internet Explorer"==navigator.appName&&
(b=/MSIE ([0-9]{1,}[\.0-9]{0,})/,null!=b.exec(c)&&(a=parseFloat(RegExp.$1,10)));return a}function h(){var a=l.navigator;return-1<a.userAgent.indexOf("Safari")&&-1==a.userAgent.indexOf("Chrome")}function g(){var a=arguments[0]||{},c=1,b=arguments.length,d=!1,e,f,h,k;"boolean"===typeof a&&(d=a,a=arguments[1]||{},c=2);if(e="object"!==typeof a)e={},e=!(a&&"[object Function]"===e.toString.call(a));e&&(a={});b===c&&(a=this,--c);for(;c<b;c++)if(null!=(e=arguments[c]))for(f in e)e.hasOwnProperty(f)&&(h=a[f],
k=e[f],a!==k&&(d&&k&&"object"===typeof k&&!k.nodeType?a[f]=g(d,h||(null!=k.length?[]:{}),k):void 0!==k&&(a[f]=k)));return a}function e(a){var c=this,b;b={minHeight:80,maxHeight:!1,scroll:!0};c.settings=g(!0,{container:"epiceditor",basePath:"epiceditor",textarea:void 0,clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,file:{name:null,defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-dark.css"},
focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},string:{togglePreview:"Toggle Preview Mode",toggleEdit:"Toggle Edit Mode",toggleFullscreen:"Enter Fullscreen"},parser:"function"==typeof marked?marked:null,autogrow:!1,button:{fullscreen:!0,preview:!0,bar:"auto"}},a||{});a=c.settings.button;c._fullscreenEnabled="object"===typeof a?"undefined"===typeof a.fullscreen||a.fullscreen:!0===a;c._editEnabled="object"===typeof a?"undefined"===typeof a.edit||a.edit:!0===a;c._previewEnabled="object"===
typeof a?"undefined"===typeof a.preview||a.preview:!0===a;if("function"!=typeof c.settings.parser||"string"!=typeof c.settings.parser("TEST"))c.settings.parser=function(a){return a};c.settings.autogrow&&(c.settings.autogrow=!0===c.settings.autogrow?b:g(!0,b,c.settings.autogrow),c._oldHeight=-1);c.settings.theme.preview.match(/^https?:\/\//)||(c.settings.theme.preview=c.settings.basePath+c.settings.theme.preview);c.settings.theme.editor.match(/^https?:\/\//)||(c.settings.theme.editor=c.settings.basePath+
c.settings.theme.editor);c.settings.theme.base.match(/^https?:\/\//)||(c.settings.theme.base=c.settings.basePath+c.settings.theme.base);"string"==typeof c.settings.container?c.element=document.getElementById(c.settings.container):"object"==typeof c.settings.container&&(c.element=c.settings.container);c.settings.file.name||("string"==typeof c.settings.container?c.settings.file.name=c.settings.container:"object"==typeof c.settings.container&&(c.element.id?c.settings.file.name=c.element.id:(e._data.unnamedEditors||
(e._data.unnamedEditors=[]),e._data.unnamedEditors.push(c),c.settings.file.name="__epiceditor-untitled-"+e._data.unnamedEditors.length)));"show"===c.settings.button.bar&&(c.settings.button.bar=!0);"hide"===c.settings.button.bar&&(c.settings.button.bar=!1);c._instanceId="epiceditor-"+Math.round(1E5*Math.random());c._storage={};c._canSave=!0;c._defaultFileSchema=function(){return{content:c.settings.file.defaultContent,created:new Date,modified:new Date}};localStorage&&c.settings.clientSideStorage&&
(this._storage=localStorage,this._storage[c.settings.localStorageName]&&void 0===c.getFiles(c.settings.file.name)&&(b=c._defaultFileSchema(),b.content=c.settings.file.defaultContent));this._storage[c.settings.localStorageName]||(b={},b[c.settings.file.name]=c._defaultFileSchema(),b=JSON.stringify(b),this._storage[c.settings.localStorageName]=b);c._previewDraftLocation="__draft-";c._storage[c._previewDraftLocation+c.settings.localStorageName]=c._storage[c.settings.localStorageName];c._eeState={fullscreen:!1,
always:!1,preview:!1,edit:!1,loaded:!1,unloaded:!1};c.events||(c.events={});return this}e.prototype.load=function(a){var c;function b(a){if("auto"===d.settings.button.bar){if(5<=Math.abs(K.y-a.pageY)||5<=Math.abs(K.x-a.pageX))g.style.display="block",m&&clearTimeout(m),m=l.setTimeout(function(){g.style.display="none"},1E3);K={y:a.pageY,x:a.pageX}}}if(this.is("loaded"))return this;var d=this,e,g,m,J,K={y:-1,x:-1},r,C,D=!1,A=!1,E=!1,F=!1,w,B=!1,I=!1,z;d._eeState.startup=!0;d.settings.useNativeFullscreen&&
(A=document.body.webkitRequestFullScreen?!0:!1,E=document.body.mozRequestFullScreen?!0:!1,F=document.body.requestFullscreen?!0:!1,D=A||E||F);h()&&(A=D=!1);"edit"===d.settings.defaultEditType?(C="edit",d._eeState.edit=!0):"preview"===d.settings.defaultEditType?(C="preview",d._eeState.preview=!0):(C="always",d._eeState.always=!0);a=a||function(){};var G='<div id="js-dialog-link" class="dialog dialog-fixed"> <div class="dialog-box">     <div class="dialog-content">         <div class="dialog-header">             <button type="button" class="close">\u00d7</button>             <h4 class="dialog-title">\u63d2\u5165\u94fe\u63a5</h4>         </div>         <div class="dialog-body">             <input id="js-aml-ipt" type="text" value="" placeholder="\u8bf7\u8f93\u5165\u94fe\u63a5">         </div>         <div class="dialog-footer">             <button type="button" class="btn btn-normal-btn">\u53d6\u6d88</button>             <button id="dialogAmlBtn" class="btn dialog-aml-btn" type="button">\u63d2\u5165</button>         </div>     </div> </div></div>',
y='<div id="js-dialog-image" class="dialog dialog-fixed upload-image"> <div class="dialog-box">     <div class="dialog-content">         <div class="dialog-header">             <button type="button" class="close">\u00d7</button>             <h4 class="dialog-title">\u63d2\u5165\u56fe\u7247</h4>         </div>          <div class="image-uploader-tab">             <a href="javascript:;" class="tab-upload">\u4e0a\u4f20\u56fe\u7247</a>              \u6216               <a href="javascript:;" class="tab-link">\u5f15\u7528\u7ad9\u5916\u56fe\u7247</a>           </div>         <div class="dialog-body selected">             <input id="selectImage" class="upload-btn" type="button" value="\u9009\u62e9\u56fe\u7247" >         </div>         <div class="dialog-body inline">             <input class="image-url" id="imageUrl" type="text" value="" placeholder="\u8bf7\u8f93\u5165\u94fe\u63a5">             <input class="submit-btn" type="button" value="\u786e\u8ba4">         </div>         <div class="dialog-footer">         </div>     </div> </div></div>';
e={heading:'<li class="md-icon md-heading" title="\u6807\u9898">    <div class="hide_panel">      <h1 class="item-select ent-toolbar-heading1">#\u6807\u98981</h1>      <h2 class="item-select ent-toolbar-heading2">##\u6807\u98982</h2>      <h3 class="item-select ent-toolbar-heading3">###\u6807\u98983</h3>      <h4 class="item-select ent-toolbar-heading4">####\u6807\u98984</h4>      <h5 class="item-select ent-toolbar-heading5">#####\u6807\u98985</h5>    </div></li>',bold:'<li class="md-icon ent-toolbar-bold md-bold" title="\u7c97\u4f53"></li>',
italic:'<li class="md-icon ent-toolbar-italic md-italic" title="\u659c\u4f53"></li>',underline:'<li class="md-icon ent-toolbar-underline md-underline" title="\u7279\u522b\u63d0\u793a"></li>',quote:'<li class="md-icon ent-toolbar-quote md-quote" title="\u5f15\u7528"></li>',code:'<li class="md-icon ent-toolbar-code md-code" title="\u4ee3\u7801"></li>',link:'<li class="md-icon md-url" title="\u8d85\u94fe\u63a5"></li>',image:'<li class="md-icon md-image" title="\u63d2\u5165\u56fe\u7247"></li>',ol:'<li class="md-icon ent-toolbar-list-ol md-list-ol" title="\u6709\u5e8f\u5217\u8868"></li>',
ul:'<li class="md-icon ent-toolbar-list-ul md-list-ul" title="\u65e0\u5e8f\u5217\u8868"></li>',edType:'<li class="md-icon md-editor-full" title="\u6a21\u5f0f">    <div class="hide_panel">      <div class="item-select toggle-edit">\u7f16\u8f91\u6a21\u5f0f</div>      <div class="item-select toggle-always">\u5b9e\u65f6\u9884\u89c8</div>      <div class="item-select toggle-preview">\u9884\u89c8\u6a21\u5f0f</div>    </div></li>',fullscreen:'<li class="md-icon md-view-full" title="\u6700\u5927\u5316"></li>',
clear:'<li class="md-icon toggle-empty md-empty" title="\u6e05\u7a7a"></li>'};var H="";if(d.settings.toolbars)for(c=0;c<d.settings.toolbars.length;c++)H+=e[d.settings.toolbars[c]];else for(x in e)H+=e[x];c='<div id="epiceditor-wrapper" class="epiceditor-edit-mode">'+G+y+'<div id="epiceditor-utilbar"><ul class="md-button">'+H+"</ul>"+(d._previewEnabled?'<button title="'+this.settings.string.togglePreview+'" class="epiceditor-toggle-btn epiceditor-toggle-preview-btn"></button> ':"")+(d._editEnabled?
'<button title="'+this.settings.string.toggleEdit+'" class="epiceditor-toggle-btn epiceditor-toggle-edit-btn"></button> ':"")+(d._fullscreenEnabled?'<button title="'+this.settings.string.toggleFullscreen+'" class="epiceditor-fullscreen-btn"></button>':"")+'</div><iframe frameborder="0" id="epiceditor-editor-frame"></iframe><iframe frameborder="0" id="epiceditor-previewer-frame"></iframe></div>';d.element.innerHTML='<iframe scrolling="no" frameborder="0" class="epiceditor-box" id= "'+d._instanceId+
'"></iframe>';e=document.getElementById(d._instanceId);d.iframeElement=e;d.iframe=k(e);d.iframe.open();d.iframe.write(c);d.utilbar=d.iframe.getElementById("epiceditor-utilbar");d.editorIframe=d.iframe.getElementById("epiceditor-editor-frame");d.previewerIframe=d.iframe.getElementById("epiceditor-previewer-frame");d.editorIframeDocument=k(d.editorIframe);d.editorIframeDocument.open();d.editorIframeDocument.write("<!doctype HTML>");d.editorIframeDocument.close();d.previewerIframeDocument=k(d.previewerIframe);
d.previewerIframeDocument.open();d.previewerIframeDocument.write('<div id="epiceditor-preview"></div>');c=d.previewerIframeDocument.createElement("base");c.target="_blank";d.previewerIframeDocument.getElementsByTagName("head")[0].appendChild(c);d.previewerIframeDocument.close();p(d.settings.theme.base,d.iframe,"theme");p(d.settings.theme.editor,d.editorIframeDocument,"theme");p(d.settings.theme.preview,d.previewerIframeDocument,"theme");d.iframe.getElementById("epiceditor-wrapper").style.position=
"relative";d.settings.button.bar&&(d.utilbar.style.display="block");d.reflow();d.editor=d.editorIframeDocument.body;d.previewer=d.previewerIframeDocument.getElementById("epiceditor-preview");d.editor.contentEditable=!0;this.editorIframeDocument.body.style.wordWrap="break-word";-1<f()&&(this.previewer.style.height=parseInt(n(this.previewer,"height"),10)+2);this.open(d.settings.file.name);d.settings.focusOnLoad&&d.iframe.addEventListener("readystatechange",function(){"complete"==d.iframe.readyState&&
d.focus()});d.previewerIframeDocument.addEventListener("click",function(a){var c=a.target,b=d.previewerIframeDocument.body;"A"==c.nodeName&&c.hash&&c.hostname==l.location.hostname&&(a.preventDefault(),c.target="_self",b.querySelector(c.hash)&&(b.scrollTop=b.querySelector(c.hash).offsetTop))});c=d.iframe.getElementById("epiceditor-utilbar");r={};d._goFullscreen=function(a){this._fixScrollbars("auto");if(d.is("fullscreen"))d._exitFullscreen(a);else{D&&(A?a.webkitRequestFullScreen():E?a.mozRequestFullScreen():
F&&a.requestFullscreen());d._eeState.fullscreen=!0;d._eeState.edit=!0;d._eeState.preview=!0;a=v(d.element);var c=u(d.element);r.editorIframe=q(d.editorIframe,"save",{width:a/2+"px",height:c+"px","float":"left",cssFloat:"left",styleFloat:"left",display:"block",position:"static",left:""});r.previewerIframe=q(d.previewerIframe,"save",{width:a/2+"px",height:c+"px","float":"right",cssFloat:"right",styleFloat:"right",display:"block",position:"static",left:""});r.element=q(d.element,"save",{position:"fixed",
top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",margin:"0",background:n(d.editor,"background-color"),height:"100% "});D||(document.body.style.overflow="hidden");d.preview();d.focus();d.emit("fullscreenenter")}};d._exitFullscreen=function(a){this._fixScrollbars();q(d.element,"apply",r.element);q(d.iframeElement,"apply",r.iframeElement);q(d.editorIframe,"apply",r.editorIframe);q(d.previewerIframe,"apply",r.previewerIframe);d.element.style.width=d._eeState.reflowWidth?d._eeState.reflowWidth:
"";d.element.style.height=d._eeState.reflowHeight?d._eeState.reflowHeight:"";d._eeState.fullscreen=!1;D?A?document.webkitCancelFullScreen():E?document.mozCancelFullScreen():F&&document.exitFullscreen():document.body.style.overflow="auto";"edit"===C?d.edit():"preview"===C?d.preview():d.alwaysPreview();d.reflow();d.emit("fullscreenexit")};d.editor.addEventListener("keyup",function(a){13==a.keyCode&&d._eeState.enterType&&d.autoEnter();8==a.keyCode&&d._eeState.enterType&&!d.editorIframe.contentWindow.getSelection().baseNode.data&&
(d._eeState.enterType="");d._eeState.selectText="";J&&l.clearTimeout(J);J=l.setTimeout(function(){if(d.is("fullscreen")||d.is("always"))d.save(!0),d.previewer.innerHTML=d.exportFile(null,"html",!0)},250)});d.editor.addEventListener("mouseup",function(a){a=d.editorIframeDocument.getSelection();d._eeState.selectText=a.toString();a=d.editorIframe.contentWindow.getSelection();a.baseNode.data?(a=a.baseNode.data.replace(/(^\s*)|(\s*$)/g,""),">"===a.substr(0,1)?d._eeState.enterType="blockquote":a.substr(0,
1)==parseInt(a.substr(0,1))?d._eeState.enterType="list-ol":"-"===a.slice(-5)?d._eeState.enterType="list-ul":d._eeState.enterType=""):d._eeState.enterType=""});w=d.iframeElement;c.addEventListener("click",function(a){var c=a.target.className;-1<c.indexOf("toggle-preview")?d.preview():-1<c.indexOf("toggle-edit")?d.edit():-1<c.indexOf("md-empty")?d.open(" "):-1<c.indexOf("epiceditor-fullscreen-btn")?d._goFullscreen(w):-1<c.indexOf("md-view-full")?d.maxEditor(a.target):-1<c.indexOf("ent-toolbar")?d.enterContent(a.target):
-1<c.indexOf("md-url")?d.iframe.getElementById("js-dialog-link").style.display="block":-1<c.indexOf("md-image")?d.iframe.getElementById("js-dialog-image").style.display="block":-1<c.indexOf("toggle-always")&&d.alwaysPreview(w)});A?document.addEventListener("webkitfullscreenchange",function(){!document.webkitIsFullScreen&&d._eeState.fullscreen&&d._exitFullscreen(w)},!1):E?document.addEventListener("mozfullscreenchange",function(){!document.mozFullScreen&&d._eeState.fullscreen&&d._exitFullscreen(w)},
!1):F&&document.addEventListener("fullscreenchange",function(){null==document.fullscreenElement&&d._eeState.fullscreen&&d._exitFullscreen(w)},!1);g=d.iframe.getElementById("epiceditor-utilbar");!0!==d.settings.button.bar&&(g.style.display="none");g.addEventListener("mouseover",function(){m&&clearTimeout(m)});G=d.iframe.getElementById("js-dialog-link");G.addEventListener("click",function(a){if("close"===a.target.className||"btn btn-normal-btn"===a.target.className)G.style.display="none";"btn dialog-aml-btn"===
a.target.className&&(G.style.display="none",d.enterContent(a.target))});y=d.iframe.getElementById("js-dialog-image");y.addEventListener("click",function(a){"close"===a.target.className||"btn btn-normal-btn"===a.target.className?y.style.display="none":"tab-upload"===a.target.className?y.className=y.className.replace("inline-image","upload-image"):"tab-link"===a.target.className?y.className=y.className.replace("upload-image","inline-image"):"submit-btn"===a.target.className&&(a=d.iframe.getElementById("imageUrl").value,
d.iframe.getElementById("imageUrl").value="",d.enterImage(a))});e=[d.previewerIframeDocument,d.editorIframeDocument];for(c=0;c<e.length;c++)e[c].addEventListener("mousemove",function(a){b(a)}),e[c].addEventListener("scroll",function(a){b(a)}),e[c].addEventListener("keyup",function(a){a.keyCode==d.settings.shortcut.modifier&&(B=!1);17==a.keyCode&&(I=!1)}),e[c].addEventListener("keydown",function(a){a.keyCode==d.settings.shortcut.modifier&&(B=!0);17==a.keyCode&&(I=!0);!0!==B||a.keyCode!=d.settings.shortcut.preview||
d.is("fullscreen")||(a.preventDefault(),d.is("edit")&&d._previewEnabled?d.preview():d._editEnabled&&d.edit());!0===B&&a.keyCode==d.settings.shortcut.fullscreen&&d._fullscreenEnabled&&(a.preventDefault(),d._goFullscreen(w));!0===B&&a.keyCode!==d.settings.shortcut.modifier&&(B=!1);27==a.keyCode&&d.is("fullscreen")&&d._exitFullscreen(w);!0===I&&83==a.keyCode&&(d.save(),a.preventDefault(),I=!1);a.metaKey&&83==a.keyCode&&(d.save(),a.preventDefault())}),e[c].addEventListener("paste",function(a){a.clipboardData?
(a.preventDefault(),a=a.clipboardData.getData("text/plain"),d.editorIframeDocument.execCommand("insertText",!1,a)):l.clipboardData&&(a.preventDefault(),a=l.clipboardData.getData("Text"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/\n/g,"<br>"),a=a.replace(/\r/g,""),a=a.replace(/<br>\s/g,"<br>&nbsp;"),a=a.replace(/\s\s\s/g,"&nbsp; &nbsp;"),a=a.replace(/\s\s/g,"&nbsp; "),d.editorIframeDocument.selection.createRange().pasteHTML(a))});d.settings.file.autoSave&&(d._saveIntervalTimer=
l.setInterval(function(){d._canSave&&d.save(!1,!0)},d.settings.file.autoSave));d.settings.textarea&&d._setupTextareaSync();l.addEventListener("resize",function(){d.is("fullscreen")?(t(d.iframeElement,{width:l.outerWidth/2+"px",height:l.innerHeight+"px"}),t(d.element,{height:l.innerHeight+"px"}),t(d.previewerIframe,{width:l.outerWidth/2+"px",height:l.innerHeight+"px"}),t(d.editorIframe,{width:l.outerWidth/2+"px",height:l.innerHeight+"px"})):d.is("fullscreen")||d.reflow()});d._eeState.loaded=!0;d._eeState.unloaded=
!1;d.is("preview")?d.preview():d.is("edit")?d.edit():d.alwaysPreview();d.iframe.close();d._eeState.startup=!1;d.settings.autogrow&&(d._fixScrollbars(),z=function(){setTimeout(function(){d._autogrow()},1)},["keydown","keyup","paste","cut"].forEach(function(a){d.getElement("editor").addEventListener(a,z)}),d.on("__update",z),d.on("edit",function(){setTimeout(z,50)}),d.on("preview",function(){setTimeout(z,50)}),setTimeout(z,50),z());a.call(this);this.emit("load");return this};e.prototype._setupTextareaSync=
function(){var a=this,c=a.settings.file.name,b;a._textareaSaveTimer=l.setInterval(function(){a._canSave&&a.save(!0)},100);b=function(){a._textareaElement.value=a.exportFile(c,"text",!0)||a.settings.file.defaultContent};"string"==typeof a.settings.textarea?a._textareaElement=document.getElementById(a.settings.textarea):"object"==typeof a.settings.textarea&&(a._textareaElement=a.settings.textarea);""!==a._textareaElement.value&&(a.importFile(c,a._textareaElement.value),a.save(!0));b();a.on("__update",
b)};e.prototype._focusExceptOnLoad=function(){(this._eeState.startup&&this.settings.focusOnLoad||!this._eeState.startup)&&this.focus()};e.prototype.unload=function(a){if(this.is("unloaded"))throw Error("Editor isn't loaded");var c=l.parent.document.getElementById(this._instanceId);c.parentNode.removeChild(c);this._eeState.loaded=!1;this._eeState.unloaded=!0;a=a||function(){};this.settings.textarea&&(this._textareaElement.value="",this.removeListener("__update"));this._saveIntervalTimer&&l.clearInterval(this._saveIntervalTimer);
this._textareaSaveTimer&&l.clearInterval(this._textareaSaveTimer);a.call(this);this.emit("unload");return this};e.prototype.preview=function(){var a=this.settings.theme.preview;this.iframe.getElementById("epiceditor-wrapper").setAttribute("class","epiceditor-preview-mode");this.previewerIframeDocument.getElementById("theme")?this.previewerIframeDocument.getElementById("theme").name!==a&&(this.previewerIframeDocument.getElementById("theme").href=a):p(a,this.previewerIframeDocument,"theme");this.save(!0);
this.previewer.innerHTML=this.exportFile(null,"html",!0);this._eeState.preview=!0;this._eeState.edit=!1;this._eeState.always=!1;this.reflow();this.emit("preview");return this};e.prototype.focus=function(a){var c=(a=this.is("preview"))?this.previewerIframeDocument.body:this.editorIframeDocument.body,b=l.navigator;-1<b.userAgent.indexOf("Firefox")&&-1==b.userAgent.indexOf("Seamonkey")&&a&&(c=this.previewerIframe);c.focus();return this};e.prototype.enterFullscreen=function(){if(this.is("fullscreen"))return this;
this._goFullscreen(this.iframeElement);return this};e.prototype.exitFullscreen=function(){if(!this.is("fullscreen"))return this;this._exitFullscreen(this.iframeElement);return this};e.prototype.edit=function(){this.iframe.getElementById("epiceditor-wrapper").setAttribute("class","epiceditor-edit-mode");this._eeState.preview=!1;this._eeState.edit=!0;this._eeState.always=!1;this._focusExceptOnLoad();this.reflow();this.emit("edit");return this};e.prototype.getElement=function(a){var c={container:this.element,
wrapper:this.iframe.getElementById("epiceditor-wrapper"),wrapperIframe:this.iframeElement,editor:this.editorIframeDocument,editorIframe:this.editorIframe,previewer:this.previewerIframeDocument,previewerIframe:this.previewerIframe};return!c[a]||this.is("unloaded")?this.is("unloaded")?null:this.iframe.getElementById(a):c[a]};e.prototype.is=function(a){switch(a){case "always":return this._eeState.always;case "loaded":return this._eeState.loaded;case "unloaded":return this._eeState.unloaded;case "preview":return this._eeState.preview;
case "edit":return this._eeState.edit;case "fullscreen":return this._eeState.fullscreen;default:return!1}};e.prototype.open=function(a){var c=this.settings.file.defaultContent;a=a||this.settings.file.name;this.settings.file.name=a;this._storage[this.settings.localStorageName]&&(a=this.exportFile(a),void 0!==a?(m(this.editor,a),this.emit("read")):(m(this.editor,c),this.save(),this.emit("create")),this.previewer.innerHTML=this.exportFile(null,"html"),this.emit("open"));return this};e.prototype.save=
function(a,c){var b,d=!1,e=this.settings.file.name,g="";b=this._storage[g+this.settings.localStorageName];var f;f=this.editor;"string"==typeof document.body.innerText?f=f.innerText:(f=f.innerHTML.replace(/<br>/gi,"\n"),f=f.replace(/<(?:.|\n)*?>/gm,""),f=f.replace(/&lt;/gi,"<"),f=f.replace(/&gt;/gi,">"));a&&(g=this._previewDraftLocation);this._canSave=!0;if(b){b=JSON.parse(this._storage[g+this.settings.localStorageName]);if(void 0===b[e])b[e]=this._defaultFileSchema();else if(f!==b[e].content)b[e].modified=
new Date,d=!0;else if(c)return;b[e].content=f;this._storage[g+this.settings.localStorageName]=JSON.stringify(b);d&&(this.emit("update"),this.emit("__update"));c?this.emit("autosave"):a||this.emit("save")}return this};e.prototype.remove=function(a){var c;a=a||this.settings.file.name;a==this.settings.file.name&&(this._canSave=!1);c=JSON.parse(this._storage[this.settings.localStorageName]);delete c[a];this._storage[this.settings.localStorageName]=JSON.stringify(c);this.emit("remove");return this};e.prototype.rename=
function(a,c){var b=JSON.parse(this._storage[this.settings.localStorageName]);b[c]=b[a];delete b[a];this._storage[this.settings.localStorageName]=JSON.stringify(b);this.open(c);return this};e.prototype.importFile=function(a,c,b,d){var e=this;b=!1;a=a||e.settings.file.name;c=c||"";void 0===JSON.parse(this._storage[e.settings.localStorageName])[a]&&(b=!0);e.settings.file.name=a;m(e.editor,c);b&&e.emit("create");e.save();e.is("fullscreen")&&e.preview();e.settings.autogrow&&setTimeout(function(){e._autogrow()},
50);return this};e.prototype._getFileStore=function(a,c){var b="";c&&(b=this._previewDraftLocation);b=JSON.parse(this._storage[b+this.settings.localStorageName]);return a?b[a]:b};e.prototype.exportFile=function(a,c,e){a=a||this.settings.file.name;c=c||"text";a=this._getFileStore(a,e);if(void 0!==a)switch(e=a.content,c){case "html":return e=b(e),this.settings.parser(e);case "text":return b(e);case "json":return a.content=b(a.content),JSON.stringify(a);case "raw":return e;default:return e}};e.prototype.getFiles=
function(a,c){var e,d=this._getFileStore(a);if(a)void 0!==d&&(c?delete d.content:d.content=b(d.content));else for(e in d)d.hasOwnProperty(e)&&(c?delete d[e].content:d[e].content=b(d[e].content));return d};e.prototype.on=function(a,c){this.events[a]||(this.events[a]=[]);this.events[a].push(c);return this};e.prototype.emit=function(a,c){var b;c=c||this.getFiles(this.settings.file.name);if(this.events[a]){for(b=0;b<this.events[a].length;b++)this.events[a][b].call(this,c);return this}};e.prototype.removeListener=
function(a,c){if(!c)return this.events[a]=[],this;if(!this.events[a])return this;this.events[a].splice(this.events[a].indexOf(c),1);return this};e.prototype._autogrow=function(){var a,c,b=!1;this.is("fullscreen")||(a=this.is("edit")?this.getElement("editor").documentElement:this.getElement("previewer").documentElement,a=u(a),c=this.settings.autogrow.minHeight,"function"===typeof c&&(c=c(this)),c&&a<c&&(a=c),c=this.settings.autogrow.maxHeight,"function"===typeof c&&(c=c(this)),c&&a>c&&(a=c,b=!0),b?
this._fixScrollbars("auto"):this._fixScrollbars("hidden"),a!=this.oldHeight&&(this.getElement("container").style.height=a+"px",this.reflow(),this.settings.autogrow.scroll&&l.scrollBy(0,a-this.oldHeight),this.oldHeight=a))};e.prototype._fixScrollbars=function(a){var c;c=this.settings.autogrow?"hidden":"auto";c=a||c;this.getElement("editor").documentElement.style.overflow=c;this.getElement("previewer").documentElement.style.overflow=c};e.prototype.enterContent=function(a){var c="t"+(new Date).getTime(),
b="";if(-1<a.className.indexOf("toolbar-heading")){a=parseInt(a.className.substr(a.className.indexOf("heading")+7,1));for(var b="<h"+a+'  class="text-cont">',d=0;d<a;d++)b+="#";b=this._eeState.selectText?b+('<span class="'+c+'">'+this._eeState.selectText+"</span></h"+a+">"):b+('<span class="'+c+'">\u8f93\u5165\u6807\u9898</span></h'+a+">")}else-1<a.className.indexOf("toolbar-bold")?b=this._eeState.selectText?b+("**"+this._eeState.selectText+"**"):b+('<span>**</span><span class="text-cont '+c+'">\u6587\u5b57</span><span>**</span>'):
-1<a.className.indexOf("toolbar-italic")?b=this._eeState.selectText?b+('*<span class="text-cont '+c+'">'+this._eeState.selectText+"</span>*"):b+('*<span class="text-cont '+c+'">\u6587\u5b57</span>*'):-1<a.className.indexOf("toolbar-underline")?b=this._eeState.selectText?b+('`<span class="text-cont '+c+'">'+this._eeState.selectText+"</span>`"):b+('`<span class="text-cont '+c+'">\u6587\u5b57</span>`'):-1<a.className.indexOf("toolbar-code")?b=this._eeState.selectText?b+('<br/>```<div class="text-cont '+
c+'">'+this._eeState.selectText+"</div>```<br/>"):b+('<br/>```<div class="text-cont '+c+'">\u8f93\u5165\u4ee3\u7801</div>```<br/>'):-1<a.className.indexOf("dialog-aml-btn")?(a=this.iframe.getElementById("js-aml-ipt").value,this.iframe.getElementById("js-aml-ipt").value="",b+='[<span class="'+c+'">\u94fe\u63a5\u63cf\u8ff0</span>]('+a+")"):-1<a.className.indexOf("toolbar-quote")?(this._eeState.enterType="blockquote",b+='<br/><span class="ace_constant blockquote"><span>> </span><span class="text-cont"></span></span>'):
-1<a.className.indexOf("toolbar-list-ol")?(this._eeState.enterType="list-ol",b+='<br /><span class="text-cont">1. </span>'):-1<a.className.indexOf("toolbar-list-ul")&&(this._eeState.enterType="list-ul",b+='<br /><span class="text-cont">- </span>');this._eeState.selectText="";this.focus();this.insertHtmlCaret(this.editorIframe.contentWindow,b);c&&this.selectText(c);this.save(!0);this.previewer.innerHTML=this.exportFile(null,"html",!0);return this};e.prototype.uploader=function(a){var c=this,b=c.iframe.getElementById("selectImage");
a&&"function"==typeof a&&(a.call(this,b),c.on("uploader",function(a){a&&(c.focus(),c.iframe.getElementById("js-dialog-image").style.display="none",c.insertHtmlCaret(c.editorIframe.contentWindow,a),c.selectText(_id),c.save(!0))}));return this};e.prototype.enterImage=function(a){var c="t"+(new Date).getTime();a='![<span class="text-cont '+c+'">\u56fe\u7247\u63cf\u8ff0</span>]('+a+")";this.focus();this.iframe.getElementById("js-dialog-image").style.display="none";this.insertHtmlCaret(this.editorIframe.contentWindow,
a);this.selectText(c);this.save(!0);return this};e.prototype.autoEnter=function(){var a="";"blockquote"==this._eeState.enterType&&(a+='<span class="ace_constant blockquote">&gt; <span class="text-cont"></span></span>');"list-ul"==this._eeState.enterType&&(a+="- ");"list-ol"==this._eeState.enterType&&(a+="1. ");this.focus();this.insertHtmlCaret(this.editorIframe.contentWindow,a);return this};e.prototype.alwaysPreview=function(){this.iframe.getElementById("epiceditor-wrapper").setAttribute("class",
"epiceditor-always-preview-mode");this._eeState.preview=!1;this._eeState.edit=!1;this._eeState.always=!0;this.save(!0);this.previewer.innerHTML=this.exportFile(null,"html",!0);this.reflow();this.emit("fullscreenenter");return this};e.prototype.maxEditor=function(a){-1<a.className.indexOf("md-view-full on")?(a.className=a.className.replace("md-view-full on","md-view-full"),a.title="\u6700\u5927\u5316",q(this.element,"apply",this.element.statesCss)):(a,a.className=a.className.replace("md-view-full",
"md-view-full on"),a.title="\u6700\u5c0f\u5316",this.element.statesCss=q(this.element,"save",{position:"fixed",top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",margin:"0",background:n(this.editor,"background-color"),height:"100% "}));this.reflow();this.emit("maxEditor");return this};e.prototype.reflow=function(a,c){var b=v(this.element)-this.element.offsetWidth,d=u(this.element)-this.element.offsetHeight,e=[this.editorIframe,this.previewerIframe],f={},g=!0===this.settings.button.bar?
39:0,h;"function"==typeof a&&(c=a,a=null);c||(c=function(){});this.iframeElement.style.width="100%";this.iframeElement.style.height="100%";for(var k=0;k<e.length;k++)a&&"width"!=a||(h=this.is("always")?(this.iframeElement.offsetWidth-2)/2+"px":this.element.offsetWidth-b+"px",e[k].style.width=h,this._eeState.reflowWidth=h,f.width=h),a&&"height"!=a||(h=this.is("fullscreen")?l.innerHeight-g+"px":this.element.offsetHeight-g-d+"px",e[k].style.height=h,this._eeState.reflowHeight=h,f.height=h);this.emit("reflow",
f);c.call(this,f);return this};e.prototype.insertHtmlCaret=function(a,c){var b,d,e=a.document;if(a.getSelection){if(b=a.getSelection(),b.getRangeAt&&b.rangeCount){d=b.getRangeAt(0);d.deleteContents();var f=e.createElement("div");f.innerHTML=c;for(var e=e.createDocumentFragment(),g,h,k;g=f.firstChild;)h=e.appendChild(g),"text-cont"===h.className&&(k=h);d.insertNode(e);h&&(h=k?k:h,d=d.cloneRange(),d.setStartAfter(h),d.collapse(!0),b.removeAllRanges(),b.addRange(d))}}else document.selection&&"Control"!=
document.selection.type&&document.selection.createRange().pasteHTML(c)};e.prototype.selectText=function(a){var b=this.editorIframe.contentWindow;a=this.editor.getElementsByClassName(a)[0];if(this.editor.createTextRange)b=this.editor.createTextRange(),b.moveToElementText(a),b.select();else if(b.getSelection){var e=b.getSelection(),b=this.editorIframeDocument.createRange();b.selectNodeContents(a);e.removeAllRanges();e.addRange(b)}else console.log("none")};e.version="0.2.2";e._data={};l.EpicEditor=e})(window);
(function(){function l(b){this.tokens=[];this.tokens.links={};this.options=b||p.defaults;this.rules=k.normal;this.options.gfm&&(this.rules=this.options.tables?k.tables:k.gfm)}function r(b,f){this.options=f||p.defaults;this.links=b;this.rules=m.normal;if(!this.links)throw Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?m.breaks:m.gfm:this.options.pedantic&&(this.rules=m.pedantic)}function t(b){this.tokens=[];this.token=null;this.options=b||p.defaults}
function n(b,f){return b.replace(f?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function q(b,f){b=b.source;f=f||"";return function g(e,a){if(!e)return new RegExp(b,f);a=a.source||a;a=a.replace(/(^|[^\[])\^/g,"$1");b=b.replace(e,a);return g}}function v(){}function u(b){for(var f=1,h,g;f<arguments.length;f++)for(g in h=arguments[f],h)Object.prototype.hasOwnProperty.call(h,g)&&(b[g]=h[g]);return b}function p(b,f){try{return t.parse(l.lex(b,
f),f)}catch(h){h.message+="\nPlease report this to https://github.com/chjj/marked.";if((f||p.defaults).silent)return"An error occured:\n"+h.message;throw h;}}var k={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:v,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:v,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,
def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:v,paragraph:/^([^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+\n*/,text:/^[^\n]+/,bullet:/(?:[*+-]|\d+\.)/,item:/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/};k.item=q(k.item,"gm")(/bull/g,k.bullet)();k.list=q(k.list)(/bull/g,k.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();k._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";
k.html=q(k.html)("comment",/\x3c!--[\s\S]*?--\x3e/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,k._tag)();k.paragraph=q(k.paragraph)("hr",k.hr)("heading",k.heading)("lheading",k.lheading)("blockquote",k.blockquote)("tag","<"+k._tag)("def",k.def)();k.normal=u({},k);k.gfm=u({},k.normal,{fences:/^ *(`{3,}|~{3,}) *(\w+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});k.gfm.paragraph=q(k.paragraph)("(?!","(?!"+k.gfm.fences.source.replace("\\1","\\2")+"|")();k.tables=
u({},k.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});l.rules=k;l.lex=function(b,f){return(new l(f)).lex(b)};l.prototype.lex=function(b){b=b.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(b,!0)};l.prototype.token=function(b,f){b=b.replace(/^ +$/gm,"");for(var h,g,e,a,c,k;b;){if(e=this.rules.newline.exec(b))b=b.substring(e[0].length),1<e[0].length&&
this.tokens.push({type:"space"});if(e=this.rules.code.exec(b))b=b.substring(e[0].length),e=e[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?e:e.replace(/\n+$/,"")});else if(e=this.rules.fences.exec(b))b=b.substring(e[0].length),this.tokens.push({type:"code",lang:e[2],text:e[3]});else if(e=this.rules.heading.exec(b))b=b.substring(e[0].length),this.tokens.push({type:"heading",depth:e[1].length,text:e[2]});else if(f&&(e=this.rules.nptable.exec(b))){b=b.substring(e[0].length);
a={type:"table",header:e[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:e[3].replace(/\n$/,"").split("\n")};for(c=0;c<a.align.length;c++)/^ *-+: *$/.test(a.align[c])?a.align[c]="right":/^ *:-+: *$/.test(a.align[c])?a.align[c]="center":/^ *:-+ *$/.test(a.align[c])?a.align[c]="left":a.align[c]=null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].split(/ *\| */);this.tokens.push(a)}else if(e=this.rules.lheading.exec(b))b=b.substring(e[0].length),
this.tokens.push({type:"heading",depth:"="===e[2]?1:2,text:e[1]});else if(e=this.rules.hr.exec(b))b=b.substring(e[0].length),this.tokens.push({type:"hr"});else if(e=this.rules.blockquote.exec(b))b=b.substring(e[0].length),this.tokens.push({type:"blockquote_start"}),e=e[0].replace(/^ *> ?/gm,""),this.token(e,f),this.tokens.push({type:"blockquote_end"});else if(e=this.rules.list.exec(b)){b=b.substring(e[0].length);this.tokens.push({type:"list_start",ordered:isFinite(e[2])});e=e[0].match(this.rules.item);
h=!1;k=e.length;for(c=0;c<k;c++)a=e[c],g=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(g-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+g+"}","gm"),"")),g=h||/\n\n(?!\s*$)/.test(a),c!==k-1&&(h="\n"===a[a.length-1],g||(g=h)),this.tokens.push({type:g?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(e=this.rules.html.exec(b))b=b.substring(e[0].length),
this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===e[1],text:e[0]});else if(f&&(e=this.rules.def.exec(b)))b=b.substring(e[0].length),this.tokens.links[e[1].toLowerCase()]={href:e[2],title:e[3]};else if(f&&(e=this.rules.table.exec(b))){b=b.substring(e[0].length);a={type:"table",header:e[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:e[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(c=0;c<a.align.length;c++)/^ *-+: *$/.test(a.align[c])?
a.align[c]="right":/^ *:-+: *$/.test(a.align[c])?a.align[c]="center":/^ *:-+ *$/.test(a.align[c])?a.align[c]="left":a.align[c]=null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a)}else if(f&&(e=this.rules.paragraph.exec(b)))b=b.substring(e[0].length),this.tokens.push({type:"paragraph",text:e[0]});else if(e=this.rules.text.exec(b))b=b.substring(e[0].length),this.tokens.push({type:"text",text:e[0]});else if(b)throw Error("Infinite loop on byte: "+
b.charCodeAt(0));}return this.tokens};var m={escape:/^\\([\\`*{}\[\]()#+\-.!_>|])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:v,tag:/^\x3c!--[\s\S]*?--\x3e|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:v,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,
_inside:/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,_href:/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/};m.link=q(m.link)("inside",m._inside)("href",m._href)();m.reflink=q(m.reflink)("inside",m._inside)();m.normal=u({},m);m.pedantic=u({},m.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});m.gfm=u({},m.normal,{escape:q(m.escape)("])","~])")(),url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,del:/^~{2,}([\s\S]+?)~{2,}/,
text:q(m.text)("]|","~]|")("|","|https?://|")()});m.breaks=u({},m.gfm,{br:q(m.br)("{2,}","*")(),text:q(m.gfm.text)("{2,}","*")()});r.rules=m;r.output=function(b,f,h){return(new r(f,h)).output(b)};r.prototype.output=function(b){for(var f="",h,g;b;)if(g=this.rules.escape.exec(b))b=b.substring(g[0].length),f+=g[1];else if(g=this.rules.autolink.exec(b))b=b.substring(g[0].length),"@"===g[2]?(h=":"===g[1][6]?this.mangle(g[1].substring(7)):this.mangle(g[1]),g=this.mangle("mailto:")+h):g=h=n(g[1]),f+='<a href="'+
g+'">'+h+"</a>";else if(g=this.rules.url.exec(b))b=b.substring(g[0].length),g=h=n(g[1]),f+='<a href="'+g+'">'+h+"</a>";else if(g=this.rules.tag.exec(b))b=b.substring(g[0].length),f+=this.options.sanitize?n(g[0]):g[0];else if(g=this.rules.link.exec(b))b=b.substring(g[0].length),f+=this.outputLink(g,{href:g[2],title:g[3]});else if((g=this.rules.reflink.exec(b))||(g=this.rules.nolink.exec(b)))b=b.substring(g[0].length),h=(g[2]||g[1]).replace(/\s+/g," "),(h=this.links[h.toLowerCase()])&&h.href?f+=this.outputLink(g,
h):(f+=g[0][0],b=g[0].substring(1)+b);else if(g=this.rules.strong.exec(b))b=b.substring(g[0].length),f+="<strong>"+this.output(g[2]||g[1])+"</strong>";else if(g=this.rules.em.exec(b))b=b.substring(g[0].length),f+="<em>"+this.output(g[2]||g[1])+"</em>";else if(g=this.rules.code.exec(b))b=b.substring(g[0].length),f+="<code>"+n(g[2],!0)+"</code>";else if(g=this.rules.br.exec(b))b=b.substring(g[0].length),f+="<br>";else if(g=this.rules.del.exec(b))b=b.substring(g[0].length),f+="<del>"+this.output(g[1])+
"</del>";else if(g=this.rules.text.exec(b))b=b.substring(g[0].length),f+=n(g[0]);else if(b)throw Error("Infinite loop on byte: "+b.charCodeAt(0));return f};r.prototype.outputLink=function(b,f){return"!"!==b[0][0]?'<a href="'+n(f.href)+'"'+(f.title?' title="'+n(f.title)+'"':"")+">"+this.output(b[1])+"</a>":'<img src="'+n(f.href)+'" alt="'+n(b[1])+'"'+(f.title?' title="'+n(f.title)+'"':"")+">"};r.prototype.mangle=function(b){for(var f="",h=b.length,g=0,e;g<h;g++)e=b.charCodeAt(g),.5<Math.random()&&
(e="x"+e.toString(16)),f+="&#"+e+";";return f};t.parse=function(b,f){return(new t(f)).parse(b)};t.prototype.parse=function(b){this.inline=new r(b.links,this.options);this.tokens=b.reverse();for(b="";this.next();)b+=this.tok();return b};t.prototype.next=function(){return this.token=this.tokens.pop()};t.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};t.prototype.parseText=function(){for(var b=this.token.text;"text"===this.peek().type;)b+="\n"+this.next().text;return this.inline.output(b)};
t.prototype.tok=function(){switch(this.token.type){case "space":return"";case "hr":return"<hr>\n";case "heading":return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case "code":if(this.options.highlight){var b=this.options.highlight(this.token.text,this.token.lang);null!=b&&b!==this.token.text&&(this.token.escaped=!0,this.token.text=b)}this.token.escaped||(this.token.text=n(this.token.text,!0));return"<pre><code"+(this.token.lang?' class="lang-'+this.token.lang+
'"':"")+">"+this.token.text+"</code></pre>\n";case "table":var f,h,g,e,b="<thead>\n<tr>\n";for(h=0;h<this.token.header.length;h++)f=this.inline.output(this.token.header[h]),b+=this.token.align[h]?'<th align="'+this.token.align[h]+'">'+f+"</th>\n":"<th>"+f+"</th>\n";b+="</tr>\n</thead>\n<tbody>\n";for(h=0;h<this.token.cells.length;h++){f=this.token.cells[h];b+="<tr>\n";for(e=0;e<f.length;e++)g=this.inline.output(f[e]),b+=this.token.align[e]?'<td align="'+this.token.align[e]+'">'+g+"</td>\n":"<td>"+
g+"</td>\n";b+="</tr>\n"}b+="</tbody>\n";return"<table>\n"+b+"</table>\n";case "blockquote_start":for(b="";"blockquote_end"!==this.next().type;)b+=this.tok();return"<blockquote>\n"+b+"</blockquote>\n";case "list_start":h=this.token.ordered?"ol":"ul";for(b="";"list_end"!==this.next().type;)b+=this.tok();return"<"+h+">\n"+b+"</"+h+">\n";case "list_item_start":for(b="";"list_item_end"!==this.next().type;)b+="text"===this.token.type?this.parseText():this.tok();return"<li>"+b+"</li>\n";case "loose_item_start":for(b=
"";"list_item_end"!==this.next().type;)b+=this.tok();return"<li>"+b+"</li>\n";case "html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case "paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case "text":return"<p>"+this.parseText()+"</p>\n"}};v.exec=v;p.options=p.setOptions=function(b){p.defaults=b;return p};p.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,silent:!1,highlight:null};p.Parser=t;p.parser=t.parse;p.Lexer=
l;p.lexer=l.lex;p.InlineLexer=r;p.inlineLexer=r.output;p.parse=p;"undefined"!==typeof module?module.exports=p:"function"===typeof define&&define.amd?define(function(){return p}):this.marked=p}).call(function(){return this||("undefined"!==typeof window?window:global)}());